#!/usr/bin/env make -f
-include .env
export

VENV = venv
PYTHON = $(VENV)/bin/python3
PIP = $(VENV)/bin/pip

.PHONY: help run tests clean install build

help:
	@echo "Available targets:"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z0-9_-]+:.*?## / {printf "  %-20s %s\n", $$1, $$2}' $(MAKEFILE_LIST)

run: install ## Same as install then run application in foreground mode
	$(PYTHON) src/cli.py

tests: install ## Same as installs then run unit tests
	(cd src && ../$(PYTHON) -m pytest ../tests/)

install: requirements.txt ## Create VENV and installs dependencies
	python3 -m venv $(VENV)
	$(PIP) install -r requirements.txt

clean:  ## Remove autogenerated directories
	rm -rf tests/__pycache__
	rm -rf $(VENV)

build: ## Build a dokcer image with passed TAG= variable
	docker build -t=$(TAG) .
